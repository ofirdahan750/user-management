<div class="forgot-password">
  <div class="forgot-password__container">
    <mat-card class="forgot-password__card">
      <mat-card-header class="forgot-password__header">
        <h1 class="forgot-password__title">{{ labels.RESET_PASSWORD }}</h1>
      </mat-card-header>

      <mat-card-content class="forgot-password__content">
        @if (!isSuccess()) {
          <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="forgot-password__form">
            <p class="forgot-password__description">{{ labels.ENTER_EMAIL }}</p>

            <mat-form-field appearance="outline" class="forgot-password__field">
              <mat-label>{{ labels.EMAIL }}</mat-label>
              <input 
                matInput 
                type="email"
                [formControlName]="formControls.EMAIL"
                [attr.aria-label]="labels.EMAIL"
                [attr.autocomplete]="'email'"
                [attr.autofocus]="''"
              />
              <mat-icon matPrefix>{{ icons.EMAIL }}</mat-icon>
              @if (hasEmailRequiredError) {
                <mat-error>{{ MESSAGES.REQUIRED_FIELD }}</mat-error>
              }
              @if (hasEmailFormatError) {
                <mat-error>{{ MESSAGES.INVALID_EMAIL }}</mat-error>
              }
            </mat-form-field>

            <app-submit-button
              [label]="labels.SUBMIT"
              [isLoading]="isLoading()"
              [disabled]="forgotPasswordForm.invalid"
              type="submit"
              class="forgot-password__submit"
            ></app-submit-button>
          </form>
        } @else {
          <div class="forgot-password__success">
            <mat-icon class="forgot-password__success-icon">{{ icons.CHECK_CIRCLE }}</mat-icon>
            <p class="forgot-password__success-message">{{ MESSAGES.PASSWORD_RESET_REQUEST_SUCCESS }}</p>
            
            @if (resetToken()) {
              <div class="forgot-password__demo-notice">
                <mat-icon class="forgot-password__demo-icon">{{ icons.INFO }}</mat-icon>
                <p class="forgot-password__demo-text">
                  <strong>{{ MESSAGES.DEMO_MODE_TITLE }}</strong> {{ MESSAGES.DEMO_MODE_DESCRIPTION }}
                </p>
              </div>
              <div class="forgot-password__token-actions">
                <button
                  mat-raised-button
                  [color]="MaterialColor.PRIMARY"
                  (click)="navigateToResetPassword()"
                  class="forgot-password__reset-button"
                >
                  {{ labels.RESET_PASSWORD }}
                  <mat-icon>{{ icons.ARROW_FORWARD }}</mat-icon>
                </button>
                <button
                  mat-raised-button
                  [color]="MaterialColor.ACCENT"
                  (click)="copyResetLink()"
                  class="forgot-password__copy-button"
                  [attr.aria-label]="labels.COPY_LINK"
                >
                  <mat-icon>{{ icons.COPY }}</mat-icon>
                  {{ labels.COPY_LINK }}
                </button>
              </div>
            }

            <div class="forgot-password__resend-section">
              @if (!canResend()) {
                <p class="forgot-password__countdown">
                  {{ MESSAGES.DIDNT_RECEIVE_EMAIL }} {{ countdown() }} {{ MESSAGES.SECONDS }}
                </p>
              } @else {
                <button
                  mat-button
                  [color]="MaterialColor.PRIMARY"
                  (click)="resendEmail()"
                  class="forgot-password__resend-button"
                >
                  {{ MESSAGES.RESEND_EMAIL }}
                </button>
              }
            </div>
          </div>
        }
      </mat-card-content>

      <mat-card-footer class="forgot-password__footer">
        <app-back-link
          [route]="routes.LOGIN"
          [tooltip]="labels.TOOLTIP_NAVIGATE_LOGIN"
          class="forgot-password__back-link"
        ></app-back-link>
      </mat-card-footer>
    </mat-card>
  </div>
</div>
